# 原则 - fnOS CLI

## 项目原则

### 1. 技术栈
- **语言**: JavaScript (ES2022+)
- **SDK**: fnos@0.2.0
- **CLI 框架**: Commander.js
- **日志**: Winston
- **测试**: Mocha + Chai (或类似框架)

### 2. 编码标准
- 所有异步操作使用 async/await
- 遵循 JavaScript Standard Style (或使用 standard 配置的 ESLint)
- 使用 4 个空格缩进
- 使用单引号字符串
- 使用 const/let，禁止使用 var
- 为所有公共函数添加 JSDoc 注释

### 3. 安全规则
- 永不记录敏感数据（密码、令牌、密钥）
- 将凭据存储在 `${HOME}/.fnos/settings.json` 并设置适当的文件权限 (600)
- 尽可能使用环境变量配置敏感信息
- 处理前验证所有用户输入

### 4. 性能要求
- 连接超时：最长 60 秒
- 命令超时：默认 30 秒，可配置
- 支持并发命令执行（每个命令创建新连接）
- 内存使用：典型使用下保持在 100MB 以下

### 5. 错误处理
- 所有错误必须被捕获并优雅处理
- 提供用户友好的错误消息
- 将详细错误信息记录到日志文件
- 使用适当的错误代码退出（0 表示成功，非零表示错误）

### 6. 用户体验
- 为所有命令提供清晰的帮助消息
- 一致的命令结构（command.subcommand）
- 支持原始 JSON 和格式化输出
- 详细的日志选项（-v、-vv、-vvv）
- 自动保存登录凭据以方便使用

### 7. 架构原则
- 模块化设计：分离关注点（命令、认证、日志、输出格式化）
- 依赖注入：将依赖项（客户端、记录器）传递给命令函数
- 单一职责：每个函数/模块只做好一件事
- 可测试性：所有函数都应可进行单元测试

### 8. 版本控制
- 使用语义化版本控制
- 提交消息应清晰且具有描述性
- 在 GitHub 上标记发布版本

### 9. 插件系统原则
- **插件目录结构**：
  - 官方插件存储在项目根目录的 `plugins/` 文件夹
  - 用户插件可通过配置文件 `settings.json` 中的 `pluginPaths` 数组指定任意路径
- **命令命名**：
  - 使用插件名作为命名空间前缀：`fnos <plugin-name> <command>`
  - 命令名称冲突时直接报错退出，不允许覆盖现有命令
- **插件配置**：
  - 每个插件在 `settings.json` 中有独立的配置节：`plugins.<pluginName>: { ... }`
  - 插件配置必须提供 JSON Schema 验证模式
- **插件接口**：
  - 插件必须导出标准的插件定义对象：`{ name, version, commands, schema, init }`
  - 插件通过依赖注入访问系统服务：logger, settings, auth
  - 插件错误必须直接抛出，由 CLI 统一处理
- **加载机制**：
  - 启动时一次性加载所有插件
  - 插件加载失败时记录错误并跳过，不影响其他插件
- **插件命令**：
  - 支持现有的全局选项（--raw, -v, -vv, -vvv）
  - 可以访问认证凭据（endpoint, username, password）
- **开发工具**：
  - 提供插件 SDK（包含类型定义、工具函数）
  - 提供脚手架工具：`fnos create-plugin <name>`
  - 提供开发文档和示例插件
- **安全**：
  - 插件加载前验证插件包的完整性和来源
  - 限制插件访问系统资源的权限
